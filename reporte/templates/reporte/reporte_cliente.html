{% extends 'menu/menu.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'reporte/CSS/reporte.css' %}">

<h2>Reporte por Cliente</h2>

<div class="rango-fechas-container">

    <form method="get" action="{% url 'reporte_cliente' %}">
        <label>Seleccionar cliente:</label>
        <select name="cliente" required>
            <option value="">-- Seleccione --</option>
            {% for c in clientes %}
                <option value="{{ c.id_cliente }}" {% if c.id_cliente|stringformat:"s" == cliente_id %}selected{% endif %}>
                    {{ c.nombre }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">Ver reporte</button>
    </form>
</div>

{% if pedido %}
    <h3>Pedido seleccionado</h3>
    <p><strong>ID Pedido:</strong> {{ pedido.id_pedido }}</p>
    <p><strong>Total inicial:</strong> ${{ pedido.total }}</p>
    <p><strong>Estado actual:</strong> {{ pedido.estado }}</p>

    <h3>Historial de movimientos</h3>

    {% if movimientos %}
        <table class="tabla-reporte">
            <tr>
                <th>Fecha movimiento</th>
                <th>Abono</th>
                <th>Total despu√©s</th>
                <th>Estado</th>
            </tr>

            {% for m in movimientos %}
            <tr>
                <td>{{ m.fecha }}</td>
                <td>${{ m.abono }}</td>
                <td>${{ m.total_despues }}</td>
                <td>{{ m.estado }}</td>
            </tr>
            {% endfor %}
        </table>

    {% else %}
        <p>No hay movimientos registrados para este pedido.</p>
    {% endif %}
{% endif %}

{% endblock %}
        